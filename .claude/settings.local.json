{
  "permissions": {
    "allow": [
      "Bash(npm run dev:*)",
      "Bash(timeout:*)",
      "Bash(ping -n 4 127.0.0.)",
      "Bash(dir:*)",
      "Bash(printf:*)",
      "Bash(node -e \"\nconst fs = require\\(''fs''\\);\nconst content = \\\\`// ============================================\n// PRISMA SCHEMA - KLY SAV Platform  \n// Version: 2.0 - Production Ready\n// ============================================\n\ngenerator client {\n  provider        = \"\"prisma-client-js\"\"\n  previewFeatures = [\"\"fullTextSearch\"\"]\n}\n\ndatasource db {\n  provider = \"\"postgresql\"\"\n  url      = env\\(\"\"DATABASE_URL\"\"\\)\n}\n\n// ============================================\n// ENUMS\n// ============================================\n\nenum UserRole {\n  CUSTOMER\n  AGENT\n  SUPERVISOR\n  ADMIN\n}\n\nenum TicketStatus {\n  OPEN\n  IN_PROGRESS\n  PENDING_CUSTOMER\n  PENDING_INTERNAL\n  ESCALATED\n  RESOLVED\n  CLOSED\n  REOPENED\n}\n\nenum TicketPriority {\n  LOW\n  MEDIUM\n  HIGH\n  URGENT\n}\n\nenum IssueType {\n  TECHNICAL\n  DELIVERY\n  INVOICE\n  RETURN\n  WARRANTY\n  INFORMATION\n  OTHER\n}\n\nenum MessageRole {\n  CUSTOMER\n  AGENT\n  SYSTEM\n  AI\n  INTERNAL\n}\n\nenum NotificationType {\n  TICKET_CREATED\n  TICKET_ASSIGNED\n  TICKET_STATUS_CHANGED\n  NEW_MESSAGE\n  TICKET_ESCALATED\n  SLA_WARNING\n  SLA_BREACHED\n  MENTION\n}\n\nenum AttachmentContext {\n  TICKET\n  MESSAGE\n}\n\n// ============================================\n// MODEL: USER\n// ============================================\n\nmodel User {\n  id            String    @id @default\\(cuid\\(\\)\\)\n  email         String    @unique\n  passwordHash  String?\n\n  firstName     String?\n  lastName      String?\n  displayName   String?\n  companyName   String?\n  phone         String?\n  avatarUrl     String?\n\n  role          UserRole  @default\\(CUSTOMER\\)\n  isActive      Boolean   @default\\(true\\)\n  isOnline      Boolean   @default\\(false\\)\n\n  preferences   Json?\n\n  createdAt     DateTime  @default\\(now\\(\\)\\)\n  updatedAt     DateTime  @updatedAt\n  lastLoginAt   DateTime?\n  lastSeenAt    DateTime?\n\n  tickets           Ticket[]        @relation\\(\"\"CustomerTickets\"\"\\)\n  assignedTickets   Ticket[]        @relation\\(\"\"AssignedTickets\"\"\\)\n  messages          ChatMessage[]   @relation\\(\"\"MessageAuthor\"\"\\)\n  notifications     Notification[]\n  refreshTokens     RefreshToken[]\n  auditLogs         TicketHistory[] @relation\\(\"\"HistoryActor\"\"\\)\n  mentions          ChatMessage[]   @relation\\(\"\"MessageMentions\"\"\\)\n\n  @@index\\([email]\\)\n  @@index\\([role]\\)\n  @@index\\([isOnline]\\)\n  @@index\\([companyName]\\)\n}\n\n// ============================================\n// MODEL: REFRESH TOKEN\n// ============================================\n\nmodel RefreshToken {\n  id          String    @id @default\\(cuid\\(\\)\\)\n  token       String    @unique\n  userId      String\n  user        User      @relation\\(fields: [userId], references: [id], onDelete: Cascade\\)\n\n  userAgent   String?\n  ipAddress   String?\n\n  expiresAt   DateTime\n  createdAt   DateTime  @default\\(now\\(\\)\\)\n  revokedAt   DateTime?\n  replacedBy  String?\n\n  @@index\\([userId]\\)\n  @@index\\([token]\\)\n  @@index\\([expiresAt]\\)\n}\n\n// ============================================\n// MODEL: ORDER\n// ============================================\n\nmodel Order {\n  id            String      @id @default\\(cuid\\(\\)\\)\n\n  orderNumber   String      @unique\n  plNumber      String?     @unique\n  blNumber      String?     @unique\n  invoiceNumber String?\n\n  customerName  String\n  customerEmail String?\n  customerPhone String?\n  shippingAddress Json?\n\n  totalAmount   Decimal?    @db.Decimal\\(10, 2\\)\n  currency      String      @default\\(\"\"EUR\"\"\\)\n\n  orderDate     DateTime\n  shippedDate   DateTime?\n  deliveryDate  DateTime?\n\n  status        String      @default\\(\"\"DELIVERED\"\"\\)\n  trackingNumber String?\n  trackingUrl   String?\n  carrier       String?\n\n  invoiceUrl    String?\n\n  createdAt     DateTime    @default\\(now\\(\\)\\)\n  updatedAt     DateTime    @updatedAt\n  syncedAt      DateTime?\n\n  items         OrderItem[]\n  tickets       Ticket[]\n\n  @@index\\([orderNumber]\\)\n  @@index\\([plNumber]\\)\n  @@index\\([blNumber]\\)\n  @@index\\([customerEmail]\\)\n  @@index\\([customerName]\\)\n}\n\n// ============================================\n// MODEL: ORDER ITEM\n// ============================================\n\nmodel OrderItem {\n  id              String    @id @default\\(cuid\\(\\)\\)\n  orderId         String\n  order           Order     @relation\\(fields: [orderId], references: [id], onDelete: Cascade\\)\n\n  sku             String\n  name            String\n  description     String?\n  quantity        Int\n  unitPrice       Decimal?  @db.Decimal\\(10, 2\\)\n  imageUrl        String?\n\n  warrantyEndDate DateTime?\n  serialNumber    String?\n\n  @@index\\([orderId]\\)\n  @@index\\([sku]\\)\n}\n\n// ============================================\n// MODEL: TICKET\n// ============================================\n\nmodel Ticket {\n  id              String         @id @default\\(cuid\\(\\)\\)\n  ticketNumber    String         @unique\n\n  customerId      String?\n  customer        User?          @relation\\(\"\"CustomerTickets\"\", fields: [customerId], references: [id]\\)\n  contactName     String\n  contactEmail    String\n  contactPhone    String?\n  companyName     String?\n\n  orderId         String?\n  order           Order?         @relation\\(fields: [orderId], references: [id]\\)\n\n  issueType       IssueType\n  subject         String         @db.VarChar\\(200\\)\n  description     String         @db.Text\n  affectedSkus    String[]\n\n  status          TicketStatus   @default\\(OPEN\\)\n  priority        TicketPriority @default\\(MEDIUM\\)\n  assignedToId    String?\n  assignedTo      User?          @relation\\(\"\"AssignedTickets\"\", fields: [assignedToId], references: [id]\\)\n\n  slaDeadline     DateTime?\n  slaBreached     Boolean        @default\\(false\\)\n  firstResponseAt DateTime?\n\n  resolution      String?        @db.Text\n  resolutionType  String?\n  satisfactionScore Int?\n\n  source          String         @default\\(\"\"WEB\"\"\\)\n  callbackSlot    String?\n  internalNotes   String?        @db.Text\n  tags            String[]\n\n  createdAt       DateTime       @default\\(now\\(\\)\\)\n  updatedAt       DateTime       @updatedAt\n  firstAssignedAt DateTime?\n  resolvedAt      DateTime?\n  closedAt        DateTime?\n  reopenedAt      DateTime?\n\n  attachments     Attachment[]\n  messages        ChatMessage[]\n  history         TicketHistory[]\n  notifications   Notification[]\n\n  @@index\\([ticketNumber]\\)\n  @@index\\([customerId]\\)\n  @@index\\([assignedToId]\\)\n  @@index\\([status]\\)\n  @@index\\([priority]\\)\n  @@index\\([issueType]\\)\n  @@index\\([createdAt]\\)\n  @@index\\([slaDeadline]\\)\n  @@index\\([slaBreached]\\)\n  @@index\\([assignedToId, status]\\)\n  @@index\\([status, priority]\\)\n}\n\n// ============================================\n// MODEL: CHAT MESSAGE\n// ============================================\n\nmodel ChatMessage {\n  id          String      @id @default\\(cuid\\(\\)\\)\n\n  ticketId    String\n  ticket      Ticket      @relation\\(fields: [ticketId], references: [id], onDelete: Cascade\\)\n\n  userId      String?\n  user        User?       @relation\\(\"\"MessageAuthor\"\", fields: [userId], references: [id]\\)\n  role        MessageRole\n\n  content     String      @db.Text\n  contentType String      @default\\(\"\"text\"\"\\)\n  metadata    Json?\n\n  mentions    User[]      @relation\\(\"\"MessageMentions\"\"\\)\n  attachments Attachment[]\n\n  readBy      Json?\n  isEdited    Boolean     @default\\(false\\)\n  editedAt    DateTime?\n  isDeleted   Boolean     @default\\(false\\)\n  deletedAt   DateTime?\n\n  createdAt   DateTime    @default\\(now\\(\\)\\)\n\n  @@index\\([ticketId]\\)\n  @@index\\([ticketId, createdAt]\\)\n  @@index\\([userId]\\)\n  @@index\\([createdAt]\\)\n  @@index\\([role]\\)\n}\n\n// ============================================\n// MODEL: ATTACHMENT\n// ============================================\n\nmodel Attachment {\n  id           String            @id @default\\(cuid\\(\\)\\)\n\n  context      AttachmentContext\n\n  ticketId     String?\n  ticket       Ticket?           @relation\\(fields: [ticketId], references: [id], onDelete: Cascade\\)\n  messageId    String?\n  message      ChatMessage?      @relation\\(fields: [messageId], references: [id], onDelete: Cascade\\)\n\n  filename     String\n  originalName String\n  mimeType     String\n  size         Int\n\n  url          String\n  storageKey   String?\n\n  width        Int?\n  height       Int?\n  thumbnailUrl String?\n\n  virusScanned Boolean           @default\\(false\\)\n  scanResult   String?\n\n  uploadedAt   DateTime          @default\\(now\\(\\)\\)\n  uploadedBy   String?\n\n  @@index\\([ticketId]\\)\n  @@index\\([messageId]\\)\n  @@index\\([uploadedAt]\\)\n}\n\n// ============================================\n// MODEL: TICKET HISTORY\n// ============================================\n\nmodel TicketHistory {\n  id          String   @id @default\\(cuid\\(\\)\\)\n\n  ticketId    String\n  ticket      Ticket   @relation\\(fields: [ticketId], references: [id], onDelete: Cascade\\)\n\n  actorId     String?\n  actor       User?    @relation\\(\"\"HistoryActor\"\", fields: [actorId], references: [id]\\)\n\n  action      String\n  field       String?\n  oldValue    String?\n  newValue    String?\n\n  comment     String?\n  metadata    Json?\n\n  changedAt   DateTime @default\\(now\\(\\)\\)\n  ipAddress   String?\n  userAgent   String?\n\n  @@index\\([ticketId]\\)\n  @@index\\([actorId]\\)\n  @@index\\([changedAt]\\)\n  @@index\\([action]\\)\n}\n\n// ============================================\n// MODEL: NOTIFICATION\n// ============================================\n\nmodel Notification {\n  id          String           @id @default\\(cuid\\(\\)\\)\n\n  userId      String\n  user        User             @relation\\(fields: [userId], references: [id], onDelete: Cascade\\)\n\n  type        NotificationType\n  title       String\n  body        String\n\n  ticketId    String?\n  ticket      Ticket?          @relation\\(fields: [ticketId], references: [id], onDelete: Cascade\\)\n\n  data        Json?\n\n  isRead      Boolean          @default\\(false\\)\n  readAt      DateTime?\n\n  sentByEmail Boolean          @default\\(false\\)\n  sentByPush  Boolean          @default\\(false\\)\n\n  createdAt   DateTime         @default\\(now\\(\\)\\)\n\n  @@index\\([userId]\\)\n  @@index\\([userId, isRead]\\)\n  @@index\\([ticketId]\\)\n  @@index\\([createdAt]\\)\n}\n\n// ============================================\n// MODEL: SLA CONFIGURATION\n// ============================================\n\nmodel SlaConfig {\n  id                  String         @id @default\\(cuid\\(\\)\\)\n  priority            TicketPriority\n  issueType           IssueType?\n\n  firstResponseTime   Int\n  resolutionTime      Int\n\n  businessHoursOnly   Boolean        @default\\(true\\)\n  isActive            Boolean        @default\\(true\\)\n\n  createdAt           DateTime       @default\\(now\\(\\)\\)\n  updatedAt           DateTime       @updatedAt\n\n  @@unique\\([priority, issueType]\\)\n}\n\n// ============================================\n// MODEL: CANNED RESPONSE\n// ============================================\n\nmodel CannedResponse {\n  id          String      @id @default\\(cuid\\(\\)\\)\n  title       String\n  category    String?\n  content     String      @db.Text\n  variables   String[]\n  issueTypes  IssueType[]\n  sortOrder   Int         @default\\(0\\)\n  isActive    Boolean     @default\\(true\\)\n  createdAt   DateTime    @default\\(now\\(\\)\\)\n  updatedAt   DateTime    @updatedAt\n\n  @@index\\([category]\\)\n  @@index\\([isActive]\\)\n}\n\\\\`;\nfs.writeFileSync\\(''c:/Users/henriela/OneDrive - KLY GROUPE/Bureau/DEV/apps/backend/prisma/schema.prisma'', content\\);\nconsole.log\\(''Schema written successfully''\\);\n\")",
      "Bash(node -e \"\nconst fs = require\\(''fs''\\);\nconst pkg = {\n  name: ''@kly-sav/backend'',\n  version: ''1.0.0'',\n  description: ''Backend API pour le systÃ¨me SAV KLY Groupe'',\n  main: ''dist/app.js'',\n  scripts: {\n    dev: ''tsx watch src/app.ts'',\n    build: ''tsc'',\n    start: ''node dist/app.js'',\n    ''db:generate'': ''prisma generate'',\n    ''db:push'': ''prisma db push'',\n    ''db:migrate'': ''prisma migrate dev'',\n    ''db:migrate:prod'': ''prisma migrate deploy'',\n    ''db:migrate:reset'': ''prisma migrate reset'',\n    ''db:studio'': ''prisma studio'',\n    ''db:seed'': ''tsx prisma/seed.ts'',\n    ''db:reset'': ''prisma migrate reset && tsx prisma/seed.ts'',\n    lint: ''eslint src --ext .ts'',\n    typecheck: ''tsc --noEmit'',\n    postinstall: ''prisma generate''\n  },\n  prisma: {\n    seed: ''tsx prisma/seed.ts''\n  },\n  dependencies: {\n    ''@prisma/client'': ''^5.22.0'',\n    ''bcryptjs'': ''^2.4.3'',\n    ''cors'': ''^2.8.5'',\n    ''dotenv'': ''^16.4.5'',\n    ''express'': ''^4.21.1'',\n    ''express-rate-limit'': ''^7.4.1'',\n    ''helmet'': ''^8.0.0'',\n    ''jsonwebtoken'': ''^9.0.2'',\n    ''multer'': ''^1.4.5-lts.1'',\n    ''zod'': ''^3.23.8''\n  },\n  devDependencies: {\n    ''@types/bcryptjs'': ''^2.4.6'',\n    ''@types/cors'': ''^2.8.17'',\n    ''@types/express'': ''^5.0.0'',\n    ''@types/jsonwebtoken'': ''^9.0.7'',\n    ''@types/multer'': ''^1.4.12'',\n    ''@types/node'': ''^22.9.0'',\n    prisma: ''^5.22.0'',\n    tsx: ''^4.19.2'',\n    typescript: ''^5.6.3''\n  },\n  engines: {\n    node: ''>=18.0.0''\n  }\n};\nfs.writeFileSync\\(''c:/Users/henriela/OneDrive - KLY GROUPE/Bureau/DEV/apps/backend/package.json'', JSON.stringify\\(pkg, null, 2\\)\\);\nconsole.log\\(''package.json updated''\\);\n\")",
      "Bash(npx prisma validate)",
      "Bash(npm install:*)",
      "Bash(npx tsc:*)",
      "Bash(node:*)",
      "Bash(npx kill-port:*)",
      "Bash(taskkill:*)",
      "Bash(npm run build:*)",
      "Bash(npm run typecheck:*)"
    ]
  }
}
